
#### 这里先回顾下代码管理流程：

git管理的代码分支有：主干 master、release、dev、hot、feature（可能有多个）

每次开发功能时创建开发分支 feature，然后从dev拉取代码，功能完成后，开发在 feature 完成自测

所有 feature 功能开发完毕后，合并到 dev 分支，由 QA 完成测试，开发修改 BUG 也在这个分支

QA 在 dev 完成测试后合并到 release，有的公司直接合并到 master，如果合并到 release 回归验证后还是要合并到 master 

最终将 master 代码提交到线上环境的

#### 项目上线流程

1. 回归测试
2. 上线前准备 
3. 上线后

#### 0 合并代码（测试通知开发合并代码。实际由开发操作）

在分支测试完成后通知开发合并代码到 master 回归测试，由于开发在合并代码前 leader 会对代码 code review，所以尽可能的在测试确认完成后尽快通知开发合并代码

#### 1 回归测试

回归测试的流程：

1.配置参数和环境  
2.回归主要的流程（新+老功能）  
3.将以前提的 bug 再次回归  
4.回归主要的异常流程  

用于回归测试的服务器：

专门使用一台服务器作为 master 测试服务器，开发合并代码后，拉取 master 代码部署到此服务器，进行 master 回归测试，这样做的好处是可以保持测试任务的独立性，同时也能保证测试上线配置不会遗漏。

#### 2 上线前准备 
    
第一步：上线策略

1.上线顺序  
对于前端和后端来说: 先上后端工程再上前端工程；对于多个后端工程来说：根据依赖关系确定上线顺序，被依赖的工程优先上线

2.修复数据策略    
通过给新功能的设置一个开关，新功能出现问题开关打开，走原来老流程；如果上线之后出现 BUG，由于不确定 BUG 的影响范围，所以在可能出现 BUG 的地方设置一个点，

3.旧数据分析  
仅限新功能上线后分影响老数据的那些项目。比如：针对已有功能进行流程改造，新功能上线后新数据将会按照按照改造后的流程执行，而不影响旧数据仍按照原有的走完所有流程

第二步：上线邮件

上线之前，由项目测试负责人要写上线申请邮件，邮件内容包括有：

1.线上数据配置  
数据库相关：建表语句、改表语句、索引相关  
redis 相关：提前申请 key （开关可以设置到Redis，比较灵活）  
MQ 相关：区分生产者和消费者，如果是生产者要进行注册相关、消费者订阅相关  
日志中心：新应用线上环境接入日志中心（测试不关心功能，只知道有这项就可以）  
监控中心：新应用线上环境接入监控中心  
zookeeper：两套zookeeper，一套是用来 rpc 注册中心，一套用来分布式通知  
定时任务：线上定时任务（根据具体情况设置，比如一天跑一次几点跑）  
jar包：应用新增jar包  
...  
等等包括但不限定，并且根据实际的情况配置有所增删，这一步操作是由开发开进行的，但是涉及到与功能相关的与测试有关

2.回滚策略
首先知道两个概念：部署并发度、回滚并发度  
多个工程部署，针对每个工程的回滚策略，并设计机器的回滚并发度  

3.上线注意点  
上线后可能会出现的风险，哪些地方可能容易出现问题，针对这种情况增加监控或人为监控

4.上线策略 
（第一步中考虑到的上线策略）

第三步：配置线上环境数据  
在上线前在要此项完成在线上环境中配置数据，所以尽可能的将需要配置的地方罗列完整，可以根据开发人员提测时的转测邮件来写或者测试过程中的补充配置

完全以上步骤之后，就可以由相关人员开始上线了。上代码时需要先将线上环境的job停掉?只是需要人为的打版号、标签，部署版本，停Djob任务?上线完全之后，启动Djob任务等?

#### 3 上线后 

一些BUG是在线上环境中才会被发现的原因：  
1.线上环境数据的复杂度是测试环境不能比拟的  
2.业务操作的不可控性  
3.实际场景的复杂性  

上线之后，测试人员需要做好以下二件事：

1.灰度测试
灰度测试时，可以设置由业务开关或者白名单之类做控制，只要少量数据或添加在白名单上的数据可以走新业务流程 
灰度测试完全之后，也就是将所有业务流程走完，检查各项数据的正确性、流程是否通、流程是否完整等等检查点。  
确定无问题时，再将开关打开，再开放少量真实用户数据

2.监控线上数据  
灰度测试时就已经在监控线上数据和检查线上数据，但因为灰度测试时数据量比较少，有时并不足以引发新问题，所以测试人员需要继续观察线上数据  
测试人员需要在项目上线之后的几个小时内，重点监控线上数据的流向，一旦数据有异常，立即采取措施，回滚代码又或者重新打开开关等，尽量将线上bug引起的损失降到最低，接下来就开始修改bug和修复数据

    
    
    
    - 
       
